# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a marathon training plan generator for the Eugene Full Marathon (April 26, 2026). It produces personalized 15-week training plans that integrate running, strength training, and nutrition based on athlete input data.

There is no build system or tests - this is a data-driven project using JSON schemas and markdown guides. Plans are generated by Claude based on athlete intake data and stored as JSON files. A Python-based PDF generator renders plans into branded documents.

## Directory Structure

```
eugene-marathon-plan-generator/
├── CLAUDE.md              # This file - AI assistant guidance
├── README.md              # Project overview and usage
├── requirements.txt       # Python dependencies (reportlab>=4.0.0)
│
├── guides/                # Training science documentation
│   ├── pace-zones.md      # Riegel formula, zone calculations
│   ├── hr-zones.md        # Three HR zone methods
│   ├── nutrition-timing.md# TDEE, macros, meal timing
│   ├── strength-integration.md # Periodized lifting guidance
│   └── periodization.md   # 15-week phase breakdown
│
├── intake/                # Athlete data collection
│   └── questions.md       # 17-question intake template
│
├── schema/                # Data validation
│   └── plan-schema.json   # JSON Schema (Draft-07) for plans
│
├── plans/                 # Generated training plans (JSON)
│   └── example-moderate.json # Sample 15-week plan
│
├── pdf/                   # PDF generation system
│   ├── generate_pdf.py    # Main CLI generator script
│   ├── styles.py          # Typography, colors, spacing
│   ├── quotes.json        # Inspirational quotes for PDFs
│   └── components/        # Page rendering modules
│       ├── cover.py       # Branded cover page
│       ├── overview.py    # Training overview pages
│       ├── zones_card.py  # HR/pace zones reference
│       ├── week_detail.py # Weekly training detail pages
│       └── race_week.py   # Race week preparation page
│
├── brand/                 # Visual identity
│   ├── colors.json        # "Reign or Shine" color palette
│   └── fonts.json         # Typography (Pacifico, Montserrat, Open Sans)
│
├── workflows/             # Automation
│   └── google-form-to-github.json # n8n workflow (disabled)
│
└── output/                # Generated PDF artifacts
    └── EXAMPLE-eugene-marathon-4hr-plan-20260115.pdf
```

## Workflow Overview

```
1. Athlete fills Google Form (or answers questions.md)
         ↓
2. N8N workflow commits intake data to /intake (optional)
         ↓
3. Claude generates 3 plan options using schema/plan-schema.json
         ↓
4. Plans saved to /plans/ as JSON files
         ↓
5. PDF generator renders branded document
         ↓
6. PDF output to /output/ directory
```

## Auto-Date Calculation

**IMPORTANT:** When generating a plan, always calculate dates from TODAY to the race date (April 26, 2026).

1. Calculate weeks remaining: `(Race Date - Today) / 7`
2. If less than 15 weeks remain, compress the plan (shorten base phase first)
3. If more than 15 weeks remain, add extra base weeks
4. Week 1 starts on the Monday of the current week
5. Include both `weekNumber` and `weeksUntilRace` in each week's metadata

Example date calculation:
```
Today: January 15, 2026
Race: April 26, 2026
Days until race: ~101 days
Weeks until race: ~14.4 weeks
Week 1 starts: January 13, 2026 (Monday of current week)
```

## Generating Training Plans

When asked to generate plans:

1. Collect athlete data using questions in `intake/questions.md`
2. Create 3 plan options (conservative/moderate/ambitious) following `schema/plan-schema.json`
3. Output plans to `plans/` directory as JSON files

**Key inputs needed:**
- Recent race time (for pace zone calculation)
- Heart rate data: Max HR, LTHR (if known), Resting HR
- Body composition: height, weight, age, sex (for TDEE/nutrition)
- Schedule: available days/times, blocked dates
- Strength training preferences

**Reference the example:** `plans/example-moderate.json` shows a complete plan for a 1:52:30 half marathon runner targeting a 4:00 marathon.

## PDF Generation

Generate branded PDFs from plan JSON files:

```bash
# Install dependencies
pip install -r requirements.txt

# Generate PDF
python pdf/generate_pdf.py plans/example-moderate.json output/my-plan.pdf
```

**PDF includes:**
- Branded cover page with crown icon
- HR/pace zones reference card
- Training overview with phases
- 15 weekly detail pages
- Race week preparation page

**Branding:** "Reign or Shine" twilight aesthetic with navy/purple backgrounds and neon pink + cyan accents. See `brand/colors.json` and `brand/fonts.json`.

## Training Plan Structure

Plans follow a 15-week periodization with **recovery weeks** built in:

| Phase | Weeks | Focus | Strength | Recovery Week |
|-------|-------|-------|----------|---------------|
| **Base** | 1-4 | Aerobic foundation | 3x/week full | Week 4 |
| **Build** | 5-10 | Add intensity | 2-3x/week reduced | Weeks 7, 10 |
| **Peak** | 11-13 | Max volume | 2x/week light | — |
| **Taper** | 14-15 | Sharpen | 1x/week minimal | — |
| **Race** | 16 | Race day | None | — |

### Recovery Week Pattern
Every 3-4 weeks, reduce volume by 25-30%:
- Reduce long run distance by 2-3 miles
- Keep intensity (tempo, intervals) but reduce reps/duration
- Maintain easy run frequency
- Keep 1 strength session (lighter weight)

## Key Calculation References

### Pace Zones (from Half Marathon Time)

Use Riegel formula to predict marathon time, then derive zones:

| Zone | Calculation | Example (1:52:30 HM → ~4:00 marathon) |
|------|-------------|---------------------------------------|
| **Easy** | MP + 1:30-2:30 | 10:30-11:30/mile |
| **Marathon** | Goal pace | 9:00-9:15/mile |
| **Tempo** | MP - 0:30-0:45 | 8:20-8:35/mile |
| **5K** | MP - 1:15-1:30 | 7:45-8:00/mile |
| **Interval** | MP - 1:30-1:45 | 7:30-7:45/mile |
| **Recovery** | MP + 2:30-3:30 | 11:30-12:30/mile |

**CRITICAL:** Easy pace should feel SLOW. If you can't hold a full conversation, you're going too fast.

### HR Zones
See `guides/hr-zones.md` for three methods:
1. Percentage of Max HR (simplest)
2. Percentage of LTHR (more accurate)
3. Heart Rate Reserve/Karvonen (most accurate, needs resting HR)

### Nutrition/TDEE
See `guides/nutrition-timing.md`
- BMR via Mifflin-St Jeor equation
- Activity multiplier (1.2-1.725)
- Add training calories (80-120 cal/mile running, 100-300 cal/strength session)

## Key Workout Types

### Progression Runs
Long runs should finish faster than they start:
- First 2/3: Easy pace (Zone 2)
- Final 1/3: Moderate pace (Zone 2-3)
- Last 2-3 miles: Marathon pace (optional, in build phase)

### Hill Repeats (Build Phase, weeks 5-10)
- 6-8 x 60-90 second hill efforts
- Moderate grade (4-6%)
- Jog down recovery
- Builds power and running economy

### Race Pace Long Runs (Peak Phase, weeks 11-13)
- Final 4-8 miles of long run at marathon pace
- Practice race fueling during these
- Mental and physical race simulation

## Critical Sequencing Rules

When scheduling workouts:
1. No heavy leg work within 48 hours of speed work (intervals, tempo)
2. Lift AFTER runs on same day, never before
3. No lifting the day before long runs
4. Upper body is flexible - can be scheduled most days

## Technical Stack

- **Python 3** - PDF generation
- **ReportLab 4.0.0+** - PDF rendering library
- **JSON Schema (Draft-07)** - Plan validation
- **Markdown** - Documentation and guides
- **n8n** - Workflow automation (Google Form → GitHub)

## Key Files Reference

| File | Purpose |
|------|---------|
| `schema/plan-schema.json` | Complete plan structure definition |
| `plans/example-moderate.json` | Reference implementation |
| `intake/questions.md` | 17-question athlete intake |
| `guides/*.md` | Training science documentation |
| `brand/colors.json` | Phase and workout color mappings |
